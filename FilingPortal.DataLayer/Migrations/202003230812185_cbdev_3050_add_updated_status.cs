// Generated Time: 03/23/2020 11:12:18
// Generated By: aikravchenko

using FilingPortal.Domain.Enums;
using Framework.Infrastructure.Extensions;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using FilingPortal.Parts.Common.DataLayer.Base;
using FilingPortal.Parts.Common.Domain.Enums;

namespace FilingPortal.DataLayer.Migrations
{
    public partial class cbdev_3050_add_updated_status : FpMigration
    {
        public override void Up()
        {
            Sql(GetInsertStatementFromEnum<MappingStatus>("dbo.MappingStatus"));
            Sql(GetInsertStatementFromEnum<FilingStatus>("dbo.FilingStatus"));
        }

        private static string GetInsertStatementFromEnum<TEnum>(string tableName)
        {
            var builder = new StringBuilder();
            builder.AppendLine($"SET IDENTITY_INSERT {tableName} ON");

            IEnumerable<string> values = Enum.GetValues(typeof(TEnum))
                .Cast<TEnum>()
                .Where(t=> (t as Enum).GetDescription().Equals("Updated"))
                .Select(t => $"INSERT INTO {tableName} (id, name) VALUES ({Enum.Format(typeof(TEnum), t, "d")}, '{(t as Enum).GetDescription()}')");

            builder.AppendLine(string.Join(Environment.NewLine, values));
            builder.Append($"SET IDENTITY_INSERT {tableName} OFF");
            return builder.ToString();
        }

        public override void Down()
        {
            Sql("DELETE FROM dbo.MappingStatus WHERE name = 'Updated'");
            Sql("DELETE FROM dbo.FilingStatus WHERE name = 'Updated'");
        }
    }
}
